<div id="agsModalActions-{{ mode|default('line-item-container') }}" class="btn-group" role="group" aria-label="Basic example">
{% for action in actions  %}
    {% if action == 'prepare-score' %}
        <button
                id="ags-line-item-prepare-score-btn-{{ mode|default('line-item-container') }}"
                class="btn btn-info text-white ags-line-item-action-{{ mode|default('line-item-container') }}"
                data-action="{{ action }}"
                data-registration="{{ registration.identifier }}"
                data-line-item-identifier="{{ lineItem.identifier }}"
                data-line-item-url="{{ path('tool_ajax_service_ags_prepare_score', {'lineItemIdentifier': lineItem.identifier|url_base64_encode}) }}"
        >
            <i class="fas fa-poll"></i>&nbsp;Publish score
        </button>
    {% endif %}
    {% if action == 'publish-score' %}
        <a
                id="ags-line-item-send-score-btn-{{ mode|default('line-item-container') }}"
                class="btn btn-info text-white ags-line-item-action-{{ mode|default('line-item-container') }}"
                data-action="{{ action }}"
                data-registration="{{ registration.identifier }}"
                data-line-item-identifier="{{ lineItem.identifier }}"
                data-line-item-url="{{ path('tool_ajax_service_ags_publish_score', {'lineItemIdentifier': lineItem.identifier|url_base64_encode}) }}"
        >
            <i class="fas fa-poll"></i>&nbsp;Publish score
        </a>
    {% endif %}
    {% if action == 'prepare-results' %}
        <a
                id="ags-line-item-prepare-results-btn-{{ mode|default('line-item-container') }}"
                class="btn btn-info text-white ags-line-item-action-{{ mode|default('line-item-container') }}"
                data-action="{{ action }}"
                data-registration="{{ registration.identifier }}"
                data-line-item-identifier="{{ lineItem.identifier }}"
                data-line-item-url="{{ path('tool_ajax_service_ags_prepare_results', {'lineItemIdentifier': lineItem.identifier|url_base64_encode}) }}"
        >
            <i class="fas fa-poll-h"></i>&nbsp;Get Results
        </a>
    {% endif %}
    {% if action == 'list-results' %}
        <a
                id="ags-line-item-list-results-btn-{{ mode|default('line-item-container') }}"
                class="btn btn-info text-white ags-line-item-action-{{ mode|default('line-item-container') }}"
                data-action="{{ action }}"
                data-registration="{{ registration.identifier }}"
                data-line-item-identifier="{{ lineItem.identifier }}"
                data-line-item-url="{{ path('tool_ajax_service_ags_list_results', {'lineItemIdentifier': lineItem.identifier|url_base64_encode}) }}"
        >
            <i class="fas fa-poll-h"></i>&nbsp;Get Results
        </a>
    {% endif %}
    {% if action == 'create' %}
        <a
                id="ags-line-item-create-btn-{{ mode|default('line-item-container') }}"
                class="btn btn-primary text-white ags-line-item-action-{{ mode|default('line-item-container') }}"
                data-action="{{ action }}"
                data-registration="{{ registration.identifier }}"
                data-line-item-url="{{ path('tool_ajax_service_ags_create_lineitem') }}"
        >
            <i class="fas fa-save"></i>&nbsp;Save
        </a>
    {% endif %}
    {% if action == 'edit' %}
        <a
                id="ags-line-item-edit-btn-{{ mode|default('line-item-container') }}"
                class="btn btn-primary text-white ags-line-item-action-{{ mode|default('line-item-container') }}"
                data-action="{{ action }}"
                data-registration="{{ registration.identifier }}"
                data-line-item-identifier="{{ lineItem.identifier }}"
                data-line-item-url="{{ path('tool_ajax_service_ags_prepare_update_lineitem', {'lineItemIdentifier': lineItem.identifier|url_base64_encode}) }}"
        >
            <i class="fas fa-edit"></i>&nbsp;Edit
        </a>
    {% endif %}
    {% if action == 'delete' %}
        <a
                id="ags-line-item-delete-btn-{{ mode|default('line-item-container') }}"
                class="btn btn-danger text-white ags-line-item-action-{{ mode|default('line-item-container') }}"
                data-action="{{ action }}"
                data-registration="{{ registration.identifier }}"
                data-line-item-identifier="{{ lineItem.identifier }}"
                data-line-item-url="{{ path('tool_ajax_service_ags_delete_lineitem', {'lineItemIdentifier': lineItem.identifier|url_base64_encode}) }}"
        >
            <i class="fas fa-trash"></i>&nbsp;Delete
        </a>
    {% endif %}
    {% if action == 'update' %}
        <a
                id="ags-line-item-update-btn-{{ mode|default('line-item-container') }}"
                class="btn btn-primary text-white ags-line-item-action-{{ mode|default('line-item-container') }}"
                data-action="{{ action }}"
                data-registration="{{ registration.identifier }}"
                data-line-item-identifier="{{ lineItem.identifier }}"
                data-line-item-url="{{ path('tool_ajax_service_ags_update_lineitem', {'lineItemIdentifier': lineItem.identifier|url_base64_encode}) }}"
        >
            <i class="fas fa-save"></i>&nbsp;Save
        </a>
    {% endif %}
    {% if action == 'cancel' %}
        <a
                id="ags-line-item-cancel-btn-{{ mode|default('line-item-container') }}"
                class="btn btn-secondary text-white ags-line-item-action-{{ mode|default('line-item-container') }}"
                data-action="{{ action }}"
                data-registration="{{ registration.identifier }}"
                data-line-item-identifier="{{ lineItem.identifier }}"
                data-line-item-url="{{ path('tool_ajax_service_ags_view_lineitem', {'lineItemIdentifier': lineItem.identifier|url_base64_encode}) }}"
        >
            <i class="fas fa-undo-alt"></i>&nbsp;Cancel
        </a>
    {% endif %}
    {% if action == 'go-back' %}
        <a
                id="ags-line-item-back-btn-{{ mode|default('line-item-container') }}"
                class="btn btn-secondary text-white ags-line-item-action-{{ mode|default('line-item-container') }}"
                data-action="{{ action }}"
                data-registration="{{ registration.identifier }}"
                data-line-item-identifier="{{ lineItem.identifier }}"
                data-line-item-url="{{ path('tool_ajax_service_ags_view_lineitem', {'lineItemIdentifier': lineItem.identifier|url_base64_encode}) }}"
        >
            <i class="fas fa-undo-alt"></i>&nbsp;Back to line item
        </a>
    {% endif %}
{% endfor %}
</div>
<script>
    $(".ags-line-item-action-{{ mode|default('line-item-container') }}").click(function (event) {

        event.preventDefault();

        let run = true;
        let form = false;
        let btn = $(this);

        if ($(this).data("action") === "delete") {
            run = confirm("Are you sure ?");
        }

        if ($(this).data("action") === "create" || $(this).data("action") === "update") {
            form = $('#lineItemEditForm').serialize();
        }

        if ($(this).data("action") === "publish-score") {
            form = $('#scoreSendForm').serialize();
        }

        if (run) {
            $.ajax({
                url: btn.data("line-item-url"),
                method: "GET",
                data: {
                    registration: btn.data("registration"),
                    form: form,
                    mode: "{{ mode }}",
                    scopes: "{{ scopes }}"
                },
                dataType: "json",
                beforeSend: function(result){
                    {% if mode == 'line-item' %}
                        $("#agsLineItemLogo").removeClass("fa-square");
                        $("#agsLineItemLogo").addClass("fa-spinner fa-spin");
                        $("#agsLineItemTitle").html("Processing");
                        $("#agsLineItemFlashes").html("");
                        $("#agsLineItemBody").html("processing ...");
                        $("#agsLineItemActions").html("");
                    {% else %}
                        $("#agsModalLogo").removeClass("fa-square");
                        $("#agsModalLogo").addClass("fa-spinner fa-spin");
                        $("#agsModal").modal('show');
                        $("#agsModalTitle").html("Processing");
                        $("#agsModalFlashes").html("");
                        $("#agsModalBody").html("processing ...");
                        $("#agsModalActions-{{ mode|default('line-item-container') }}").html("");
                    {% endif %}
                },
                success: function(result){
                    {% if mode == 'line-item' %}
                        $("#agsLineItemLogo").removeClass("fa-spinner fa-spin");
                        $("#agsLineItemLogo").addClass("fa-square");
                        $("#agsLineItemTitle").html(result.title);
                        $("#agsLineItemFlashes").html(result.flashes);
                        $("#agsLineItemBody").html(result.body);
                        $("#agsLineItemActions").html(result.actions);
                        //$('html, body').animate({scrollTop:$(document).height()}, 'slow');
                    {% else %}
                        $("#agsModalLogo").removeClass("fa-spinner fa-spin");
                        $("#agsModalLogo").addClass("fa-square");
                        $("#agsModalTitle").html(result.title);
                        $("#agsModalFlashes").html(result.flashes);
                        $("#agsModalBody").html(result.body);
                        $("#agsModalActions-{{ mode|default('line-item-container') }}").html(result.actions);
                        if (btn.data("action") === "create" || btn.data("action") === "delete" || btn.data("action") === "update") {
                            $("#agsLoad").click();
                        }
                    {% endif %}
                }
            });
        }
    });
</script>